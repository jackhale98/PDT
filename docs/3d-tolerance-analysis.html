<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Tolerance Analysis Guide - TDT Tessera Design Toolkit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0e14;
      --bg-secondary: #0d1117;
      --bg-elevated: #151b23;
      --bg-card: #1a2029;
      --accent: #00d4aa;
      --accent-glow: rgba(0, 212, 170, 0.15);
      --accent-dim: #00a085;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --text-muted: #4a5568;
      --border: #21262d;
      --border-accent: #00d4aa33;
      --grid-line: rgba(0, 212, 170, 0.04);
      --code-bg: #0d1117;
      --success: #3fb950;
      --warning: #d29922;
      --info: #58a6ff;
      --error: #f85149;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'IBM Plex Sans', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .grid-bg {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--grid-line) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    .grid-bg::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 50% at 50% 0%, var(--accent-glow), transparent);
    }

    h1, h2, h3, h4 {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    code, pre, .mono {
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 24px;
      position: relative;
      z-index: 1;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(10, 14, 20, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }

    nav .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--text-primary);
    }

    .logo-icon { width: 40px; height: 40px; flex-shrink: 0; }
    .logo-icon svg, .logo-icon img { width: 100%; height: 100%; }
    .logo-text {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      font-size: 20px;
      letter-spacing: -0.03em;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 32px;
    }

    .nav-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: color 0.2s;
    }

    .nav-links a:hover, .nav-links a.active { color: var(--accent); }

    .nav-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-elevated);
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .nav-btn svg { width: 18px; height: 18px; }

    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: var(--text-primary);
      cursor: pointer;
      padding: 8px;
    }

    .mobile-menu-btn svg { width: 24px; height: 24px; }

    .mobile-menu {
      display: none;
      position: fixed;
      top: 64px;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      z-index: 99;
    }

    .mobile-menu.open { display: block; }

    .mobile-menu a {
      display: block;
      padding: 12px 0;
      color: var(--text-secondary);
      text-decoration: none;
      border-bottom: 1px solid var(--border);
    }

    .mobile-menu a:last-child { border-bottom: none; }

    .tutorial-header {
      padding: 120px 0 60px;
      text-align: center;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    }

    .tutorial-header h1 {
      font-size: 42px;
      margin-bottom: 16px;
    }

    .tutorial-header h1 span { color: var(--accent); }

    .tutorial-header .description {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto;
    }

    .tutorial-layout {
      display: flex;
      gap: 40px;
      padding: 60px 0;
      max-width: 1100px;
      margin: 0 auto;
    }

    .toc-sidebar {
      position: sticky;
      top: 100px;
      width: 200px;
      flex-shrink: 0;
      height: fit-content;
    }

    .toc-sidebar h3 {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .toc-sidebar ul {
      list-style: none;
    }

    .toc-sidebar li { margin-bottom: 8px; }

    .toc-sidebar a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 13px;
      transition: color 0.2s;
    }

    .toc-sidebar a:hover { color: var(--accent); }

    .tutorial-content {
      flex: 1;
      min-width: 0;
    }

    .tutorial-section {
      margin-bottom: 60px;
    }

    .tutorial-section h2 {
      font-size: 28px;
      margin-bottom: 24px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }

    .tutorial-section h3 {
      font-size: 20px;
      margin: 32px 0 16px;
      color: var(--text-primary);
    }

    .tutorial-section h4 {
      font-size: 16px;
      margin: 24px 0 12px;
      color: var(--text-secondary);
    }

    .tutorial-section p {
      margin-bottom: 16px;
      color: var(--text-secondary);
    }

    .tutorial-section ul, .tutorial-section ol {
      margin: 0 0 20px 20px;
      color: var(--text-secondary);
    }

    .tutorial-section li {
      margin-bottom: 8px;
    }

    .code-block {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin: 16px 0;
      overflow: hidden;
    }

    .code-header {
      background: var(--bg-elevated);
      padding: 8px 16px;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-muted);
    }

    .code-block pre {
      padding: 16px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.6;
    }

    .code-block code {
      color: var(--text-primary);
    }

    .code-block .comment { color: var(--text-muted); }
    .code-block .string { color: #a5d6ff; }
    .code-block .number { color: #79c0ff; }
    .code-block .flag { color: var(--accent); }
    .code-block .cmd { color: #d2a8ff; }
    .code-block .key { color: #ff7b72; }

    .output-block {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre;
      overflow-x: auto;
      color: var(--text-secondary);
    }

    .info-box {
      background: var(--bg-elevated);
      border-left: 3px solid var(--accent);
      padding: 16px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }

    .info-box strong {
      display: block;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .info-box p {
      margin: 0;
      font-size: 14px;
    }

    .info-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 14px;
    }

    .info-table th, .info-table td {
      padding: 12px;
      text-align: left;
      border: 1px solid var(--border);
    }

    .info-table th {
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-weight: 600;
    }

    .info-table td {
      color: var(--text-secondary);
    }

    .info-table code {
      background: var(--bg-card);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }

    .gdt-symbol {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
    }

    .workflow-step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin: 20px 0;
      padding: 16px;
      background: var(--bg-card);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .workflow-step .step-num {
      width: 32px;
      height: 32px;
      background: var(--accent);
      color: var(--bg-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }

    .workflow-step .step-content {
      flex: 1;
    }

    .workflow-step .step-content strong {
      display: block;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    footer {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      padding: 40px 0;
      margin-top: 60px;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .footer-brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-text {
      color: var(--text-muted);
      font-size: 14px;
    }

    .footer-links {
      display: flex;
      gap: 24px;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }

    .footer-links a:hover { color: var(--accent); }

    @media (max-width: 900px) {
      .tutorial-layout { flex-direction: column; padding: 40px 24px; }
      .toc-sidebar { display: none; }
      .tutorial-header h1 { font-size: 32px; }
      .nav-links { display: none; }
      .mobile-menu-btn { display: block; }
      .footer-content { flex-direction: column; gap: 20px; text-align: center; }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>

  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">
        <div class="logo-icon"><img src="logo.svg" alt="TDT Logo"></div>
        <span class="logo-text">TDT</span>
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="tutorial.html">Tutorial</a>
        <a href="tolerance.html">Tolerance</a>
        <a href="3d-tolerance-analysis.html" class="active">3D Analysis</a>
        <a href="https://github.com/jackhale98/TDT" class="nav-btn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
          GitHub
        </a>
      </div>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
  </nav>

  <div class="mobile-menu" id="mobileMenu">
    <a href="index.html" onclick="closeMobileMenu()">Home</a>
    <a href="tutorial.html" onclick="closeMobileMenu()">Tutorial</a>
    <a href="tolerance.html" onclick="closeMobileMenu()">Tolerance</a>
    <a href="3d-tolerance-analysis.html" onclick="closeMobileMenu()">3D Analysis</a>
    <a href="https://github.com/jackhale98/TDT" onclick="closeMobileMenu()">GitHub</a>
  </div>

  <header class="tutorial-header">
    <div class="container">
      <h1>3D Tolerance Analysis with <span>GD&T</span></h1>
      <p class="description">Enter your GD&T callouts and let TDT compute 6-DOF tolerance stackups automatically.</p>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="tutorial-layout">
        <aside class="toc-sidebar">
          <h3>Contents</h3>
          <ul>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#gdt-reference">GD&T Reference</a></li>
            <li><a href="#workflow">Quick Start Workflow</a></li>
            <li><a href="#features">Feature Setup</a></li>
            <li><a href="#datums">Datums</a></li>
            <li><a href="#analysis">Running Analysis</a></li>
            <li><a href="#theory">Theory Deep Dive</a></li>
            <li><a href="#reference">Reference</a></li>
          </ul>
        </aside>

        <article class="tutorial-content">

          <section id="overview" class="tutorial-section">
            <h2>Overview</h2>
            <p>TDT's 3D tolerance analysis lets you work with familiar GD&T symbols from your drawings. Enter your position, perpendicularity, runout, and other callouts, and TDT automatically converts them to a 6-DOF analysis.</p>

            <div class="info-box">
              <strong>The GD&T-First Approach</strong>
              <p>Most tolerance tools require you to understand torsor theory before specifying tolerances. TDT works the other way: enter your GD&T as it appears on the drawing, and we handle the math.</p>
            </div>

            <h3>What You Get</h3>
            <ul>
              <li><strong>Automatic DOF mapping</strong> - GD&T symbols map to the correct degrees of freedom based on geometry</li>
              <li><strong>Material condition bonuses</strong> - MMC/LMC bonus calculations are automatic</li>
              <li><strong>Datum reference frames</strong> - ASME Y14.5 3-2-1 rule is applied automatically</li>
              <li><strong>Validation</strong> - TDT warns if your GD&T changes but torsor bounds are stale</li>
            </ul>
          </section>

          <section id="gdt-reference" class="tutorial-section">
            <h2>GD&T Symbol Reference</h2>
            <p>TDT supports these GD&T symbols. The table shows which degrees of freedom each symbol affects based on your geometry type.</p>

            <h3>Position and Location</h3>
            <table class="info-table">
              <thead>
                <tr><th>Symbol</th><th>GD&T</th><th>Geometry</th><th>Affects DOF</th><th>Formula</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="gdt-symbol">&#x2316;</td>
                  <td><code>position</code></td>
                  <td>cylinder</td>
                  <td>u, v</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2316;</td>
                  <td><code>position</code></td>
                  <td>sphere, point</td>
                  <td>u, v, w</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2316;</td>
                  <td><code>position</code></td>
                  <td>plane</td>
                  <td>w</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x25CE;</td>
                  <td><code>concentricity</code></td>
                  <td>cylinder, sphere</td>
                  <td>u, v</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2300;</td>
                  <td><code>symmetry</code></td>
                  <td>plane</td>
                  <td>u or v</td>
                  <td>±(tol / 2)</td>
                </tr>
              </tbody>
            </table>

            <h3>Orientation</h3>
            <table class="info-table">
              <thead>
                <tr><th>Symbol</th><th>GD&T</th><th>Geometry</th><th>Affects DOF</th><th>Formula</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="gdt-symbol">&#x27C2;</td>
                  <td><code>perpendicularity</code></td>
                  <td>cylinder, cone</td>
                  <td>&#x03B1;, &#x03B2;</td>
                  <td>±(tol / length)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x27C2;</td>
                  <td><code>perpendicularity</code></td>
                  <td>plane</td>
                  <td>&#x03B1; or &#x03B2;</td>
                  <td>±(tol / extent)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2225;</td>
                  <td><code>parallelism</code></td>
                  <td>cylinder</td>
                  <td>&#x03B1;, &#x03B2;</td>
                  <td>±(tol / length)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2225;</td>
                  <td><code>parallelism</code></td>
                  <td>plane</td>
                  <td>&#x03B1; or &#x03B2;</td>
                  <td>±(tol / extent)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2220;</td>
                  <td><code>angularity</code></td>
                  <td>any</td>
                  <td>&#x03B1;, &#x03B2;</td>
                  <td>±(tol / length)</td>
                </tr>
              </tbody>
            </table>

            <h3>Form</h3>
            <table class="info-table">
              <thead>
                <tr><th>Symbol</th><th>GD&T</th><th>Geometry</th><th>Affects DOF</th><th>Formula</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="gdt-symbol">&#x23E5;</td>
                  <td><code>flatness</code></td>
                  <td>plane</td>
                  <td>w</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x25CB;</td>
                  <td><code>cylindricity</code></td>
                  <td>cylinder</td>
                  <td>u, v</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x25CB;</td>
                  <td><code>circularity</code></td>
                  <td>cylinder, sphere</td>
                  <td>u, v</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2312;</td>
                  <td><code>straightness</code></td>
                  <td>cylinder, line</td>
                  <td>&#x03B1;, &#x03B2;</td>
                  <td>±(tol / length)</td>
                </tr>
              </tbody>
            </table>

            <h3>Runout</h3>
            <table class="info-table">
              <thead>
                <tr><th>Symbol</th><th>GD&T</th><th>Geometry</th><th>Affects DOF</th><th>Formula</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="gdt-symbol">&#x2197;</td>
                  <td><code>circular_runout</code></td>
                  <td>cylinder</td>
                  <td>u, v, &#x03B1;, &#x03B2;</td>
                  <td>radial + angular</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x21D7;</td>
                  <td><code>total_runout</code></td>
                  <td>cylinder</td>
                  <td>u, v, &#x03B1;, &#x03B2;</td>
                  <td>radial + angular</td>
                </tr>
              </tbody>
            </table>

            <h3>Profile</h3>
            <table class="info-table">
              <thead>
                <tr><th>Symbol</th><th>GD&T</th><th>Geometry</th><th>Affects DOF</th><th>Formula</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="gdt-symbol">&#x2313;</td>
                  <td><code>profile_line</code></td>
                  <td>any</td>
                  <td>w (normal)</td>
                  <td>±(tol / 2)</td>
                </tr>
                <tr>
                  <td class="gdt-symbol">&#x2313;</td>
                  <td><code>profile_surface</code></td>
                  <td>any</td>
                  <td>w (normal)</td>
                  <td>±(tol / 2)</td>
                </tr>
              </tbody>
            </table>

            <h3>Material Condition Modifiers</h3>
            <table class="info-table">
              <thead>
                <tr><th>Modifier</th><th>Code</th><th>Bonus Calculation</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>MMC</strong> (&#x24C2;)</td>
                  <td><code>mmc</code></td>
                  <td>bonus = |actual_size - mmc_size|</td>
                </tr>
                <tr>
                  <td><strong>LMC</strong> (&#x24C1;)</td>
                  <td><code>lmc</code></td>
                  <td>bonus = |actual_size - lmc_size|</td>
                </tr>
                <tr>
                  <td><strong>RFS</strong></td>
                  <td><code>rfs</code></td>
                  <td>No bonus (default)</td>
                </tr>
              </tbody>
            </table>
          </section>

          <section id="workflow" class="tutorial-section">
            <h2>Quick Start Workflow</h2>
            <p>Here's the typical workflow for 3D tolerance analysis with GD&T:</p>

            <div class="workflow-step">
              <div class="step-num">1</div>
              <div class="step-content">
                <strong>Create Feature with GD&T</strong>
                <p>Create a feature and add your GD&T controls directly from the drawing.</p>
              </div>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span></div>
              <pre><code><span class="cmd">tdt feat new</span> --title <span class="string">"Bore"</span> --component CMP@1 --feature-type internal --no-edit</code></pre>
            </div>

            <p>Then edit the feature file to add GD&T:</p>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>title: Bore
feature_type: internal
geometry_class: cylinder
geometry_3d:
  origin: [0.0, 0.0, 0.0]
  axis: [0.0, 0.0, 1.0]
  length: 25.0

dimensions:
  - name: diameter
    nominal: 20.0
    plus_tol: 0.021
    minus_tol: 0.0

<span class="comment"># GD&T from drawing</span>
gdt:
  - symbol: position
    value: 0.25
    datum_refs: [A, B]
    material_condition: mmc
  - symbol: perpendicularity
    value: 0.05
    datum_refs: [A]</code></pre>
            </div>

            <div class="workflow-step">
              <div class="step-num">2</div>
              <div class="step-content">
                <strong>Compute Torsor Bounds</strong>
                <p>Let TDT convert your GD&T to torsor bounds automatically.</p>
              </div>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span></div>
              <pre><code><span class="comment"># Preview the computed bounds</span>
<span class="cmd">tdt feat compute-bounds</span> FEAT@1

<span class="comment"># Compute and save to feature file</span>
<span class="cmd">tdt feat compute-bounds</span> FEAT@1 <span class="flag">--update</span>

<span class="comment"># Include MMC bonus (if you know actual size)</span>
<span class="cmd">tdt feat compute-bounds</span> FEAT@1 <span class="flag">--actual-size</span> <span class="number">20.015</span> <span class="flag">--update</span></code></pre>
            </div>

            <div class="output-block">
<span style="color: var(--info)">i</span> Feature: Bore (FEAT-01ABC...)
  Geometry: cylinder (length: 25.0)

<span style="color: var(--accent)">GD&T Controls:</span>
  position: 0.25 (MMC) -> u: ±0.125, v: ±0.125
  perpendicularity: 0.05 -> α: ±0.002, β: ±0.002

<span style="color: var(--success)">Computed torsor_bounds:</span>
  u: [-0.125, 0.125]
  v: [-0.125, 0.125]
  w: [0, 0]
  alpha: [-0.002, 0.002]
  beta: [-0.002, 0.002]
  gamma: [0, 0]</div>

            <div class="workflow-step">
              <div class="step-num">3</div>
              <div class="step-content">
                <strong>Create Stackup</strong>
                <p>Add features to a tolerance stackup and run 3D analysis.</p>
              </div>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span></div>
              <pre><code><span class="comment"># Create stackup</span>
<span class="cmd">tdt tol new</span> --title <span class="string">"Shaft-Bore Fit"</span> --target-name <span class="string">"Clearance"</span> \
  --target-nominal 0.02 --target-upper 0.05 --target-lower 0.005 --no-edit

<span class="comment"># Add contributors</span>
<span class="cmd">tdt tol add</span> TOL@1 +FEAT@1 ~FEAT@2

<span class="comment"># Run 3D analysis</span>
<span class="cmd">tdt tol analyze</span> TOL@1 <span class="flag">--3d</span></code></pre>
            </div>

            <div class="workflow-step">
              <div class="step-num">4</div>
              <div class="step-content">
                <strong>Keep Bounds Current</strong>
                <p>TDT validates that your torsor bounds match your GD&T.</p>
              </div>
            </div>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span></div>
              <pre><code><span class="comment"># Check for stale bounds</span>
<span class="cmd">tdt validate</span>

<span class="comment"># Auto-fix stale bounds</span>
<span class="cmd">tdt validate</span> <span class="flag">--fix</span></code></pre>
            </div>

            <div class="info-box">
              <strong>Tip: Validate After Changes</strong>
              <p>After modifying GD&T values, run <code>tdt validate</code> to ensure your torsor bounds are current. Use <code>--fix</code> to automatically update stale bounds.</p>
            </div>
          </section>

          <section id="features" class="tutorial-section">
            <h2>Feature Setup</h2>
            <p>Features need geometry information for 3D analysis. This tells TDT what type of geometry and where it is in your assembly.</p>

            <h3>Required Fields</h3>
            <table class="info-table">
              <thead>
                <tr><th>Field</th><th>Description</th><th>Example</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>geometry_class</code></td>
                  <td>Type of geometry</td>
                  <td>cylinder, plane, sphere, cone, point, line</td>
                </tr>
                <tr>
                  <td><code>geometry_3d.origin</code></td>
                  <td>Position in assembly coordinates</td>
                  <td>[0.0, 0.0, 50.0]</td>
                </tr>
                <tr>
                  <td><code>geometry_3d.axis</code></td>
                  <td>Direction vector (normalized)</td>
                  <td>[0.0, 0.0, 1.0]</td>
                </tr>
                <tr>
                  <td><code>geometry_3d.length</code></td>
                  <td>Feature length (for angular tolerances)</td>
                  <td>25.0</td>
                </tr>
                <tr>
                  <td><code>geometry_3d.length_ref</code></td>
                  <td>Optional: reference another feature's dimension</td>
                  <td>"FEAT-01ABC:depth"</td>
                </tr>
              </tbody>
            </table>

            <div class="info-box">
              <strong>Tip: Reference Dimensions</strong>
              <p>Use <code>length_ref</code> to link a feature's length to another feature's dimension. This ensures values stay in sync. Format: <code>"FEATURE_ID:dimension_name"</code>.</p>
              <p><strong>CLI command:</strong> <code>tdt feat set-length FEAT@2 --from FEAT@1:depth</code> sets the length and reference automatically.</p>
              <p>Run <code>tdt validate</code> to check for stale values, or <code>tdt validate --fix</code> to update them.</p>
            </div>

            <h3>Geometry Examples</h3>

            <h4>Cylinder (Bore or Shaft)</h4>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>geometry_class: cylinder
geometry_3d:
  origin: [0.0, 0.0, 0.0]    <span class="comment"># Center at one end</span>
  axis: [0.0, 0.0, 1.0]      <span class="comment"># Along Z axis</span>
  length: 25.0               <span class="comment"># Depth of bore</span></code></pre>
            </div>

            <h4>Plane (Face or Datum Surface)</h4>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>geometry_class: plane
geometry_3d:
  origin: [0.0, 0.0, 0.0]    <span class="comment"># Point on surface</span>
  axis: [0.0, 0.0, 1.0]      <span class="comment"># Surface normal</span></code></pre>
            </div>

            <h4>Sphere (Ball or Locating Feature)</h4>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>geometry_class: sphere
geometry_3d:
  origin: [50.0, 25.0, 10.0] <span class="comment"># Center point</span>
  axis: [0.0, 0.0, 1.0]      <span class="comment"># Reference direction</span></code></pre>
            </div>

            <h3>Coordinate System</h3>
            <p>Use a consistent coordinate system for all features. A common convention:</p>
            <div class="output-block" style="text-align: center; line-height: 1.3;">
        Z (up)
        |
        |
        |
        +--------- Y
       /
      /
     X

Right-hand rule: X x Y = Z</div>
          </section>

          <section id="datums" class="tutorial-section">
            <h2>Datums</h2>
            <p>Add <code>datum_label</code> to features that serve as datums:</p>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>title: Mounting Face
geometry_class: plane
<span class="comment"># ... geometry ...</span>

<span class="comment"># This feature is datum A</span>
datum_label: A</code></pre>
            </div>

            <p>TDT applies the ASME Y14.5 3-2-1 rule automatically:</p>
            <ul>
              <li><strong>Primary datum (A)</strong> - Constrains 3 DOF</li>
              <li><strong>Secondary datum (B)</strong> - Constrains 2 additional DOF</li>
              <li><strong>Tertiary datum (C)</strong> - Constrains final 1 DOF</li>
            </ul>

            <p>When you specify <code>datum_refs: [A, B]</code> in your GD&T, TDT only applies tolerances to DOFs not already constrained by those datums.</p>
          </section>

          <section id="analysis" class="tutorial-section">
            <h2>Running Analysis</h2>

            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span></div>
              <pre><code><span class="cmd">tdt tol analyze</span> TOL@1 <span class="flag">--3d</span></code></pre>
            </div>

            <h3>Example Output</h3>
            <div class="output-block">
<span style="color: var(--info)">i</span> Found datum features: A, B
<span style="color: var(--text-muted)">⚙</span> Analyzing stackup TOL@1 with 4 contributors...
<span style="color: var(--success)">✓</span> Analysis complete

   Target: Clearance = 0.02 (LSL: 0.005, USL: 0.05)

   <span style="color: var(--text-primary); font-weight: bold">Worst-Case Analysis:</span>
     Range: -0.01 to 0.04
     Result: <span style="color: var(--warning)">marginal</span>

   <span style="color: var(--text-primary); font-weight: bold">RSS (Statistical) Analysis:</span>
     Mean: 0.015
     ±3σ: 0.012
     Capability: Cp=1.87, Cpk=1.46
     Yield: 99.99%

   <span style="color: var(--text-primary); font-weight: bold">6-DOF Torsor Results:</span>
     Translations (mm):
       u: WC [-0.018, 0.018] RSS ±3σ=0.0102
       v: WC [-0.018, 0.018] RSS ±3σ=0.0102
       w: WC [0, 0]
     Rotations (mrad):
       α: WC [-0.50, 0.50] RSS ±3σ=0.28
       β: WC [-0.50, 0.50] RSS ±3σ=0.28
       γ: WC [0, 0]

   <span style="color: var(--text-primary); font-weight: bold">Functional Deviation</span> (projected onto [1,0,0]):
     Worst Case: 0.018
     RSS 3σ: 0.0102</div>

            <h3>How Bounds Are Used</h3>
            <p>The 3D analysis uses torsor bounds to determine geometric deviation for each contributor:</p>
            <ul>
              <li><strong>GD&T torsor_bounds</strong> - If a feature has <code>torsor_bounds</code> (computed from GD&T via <code>compute-bounds</code>), these are used directly</li>
              <li><strong>Derived bounds</strong> - If no torsor_bounds exist, bounds are derived from the contributor's dimensional tolerance</li>
            </ul>
            <p>The analysis output shows which source was used:</p>
            <div class="output-block">
<span style="color: var(--success)">✓</span> Using GD&T torsor_bounds: Bore, Shaft Journal
<span style="color: var(--info)">ℹ</span> Using derived bounds (no torsor_bounds): Spacer Thickness</div>

            <div class="info-box">
              <strong>Best Practice</strong>
              <p>For accurate 3D analysis, always define GD&T controls on your features and run <code>tdt feat compute-bounds --update</code> to generate proper torsor bounds. This ensures your analysis uses the actual geometric tolerances from your drawing rather than approximations from dimensional tolerance.</p>
            </div>

            <h3>Analysis Options</h3>
            <table class="info-table">
              <thead>
                <tr><th>Flag</th><th>Description</th></tr>
              </thead>
              <tbody>
                <tr><td><code>--3d</code></td><td>Enable 6-DOF SDT analysis</td></tr>
                <tr><td><code>--visualize</code></td><td>Show ASCII chain diagram</td></tr>
                <tr><td><code>--iterations N</code></td><td>Monte Carlo iterations (default: 10000)</td></tr>
                <tr><td><code>--no-gdt</code></td><td>Ignore GD&T position tolerances</td></tr>
              </tbody>
            </table>

            <h3>Understanding Results</h3>
            <ul>
              <li><strong>WC [min, max]</strong> - Worst-case deviation range</li>
              <li><strong>RSS ±3σ</strong> - Statistical 3-sigma spread</li>
              <li><strong>Cp/Cpk</strong> - Process capability indices</li>
              <li><strong>Zero DOFs</strong> - Fully constrained by geometry or datums</li>
            </ul>
          </section>

          <section id="theory" class="tutorial-section">
            <h2>Theory Deep Dive</h2>
            <p>This section explains the underlying math for those who want to understand how TDT works internally.</p>

            <h3>Small Displacement Torsor (SDT)</h3>
            <p>A torsor represents the small deviation of a feature from its nominal position using 6 parameters:</p>

            <table class="info-table">
              <thead>
                <tr><th>Component</th><th>Symbol</th><th>Description</th></tr>
              </thead>
              <tbody>
                <tr><td><code>u</code></td><td>u</td><td>Translation along local X</td></tr>
                <tr><td><code>v</code></td><td>v</td><td>Translation along local Y</td></tr>
                <tr><td><code>w</code></td><td>w</td><td>Translation along local Z</td></tr>
                <tr><td><code>alpha</code></td><td>&#x03B1;</td><td>Rotation about local X</td></tr>
                <tr><td><code>beta</code></td><td>&#x03B2;</td><td>Rotation about local Y</td></tr>
                <tr><td><code>gamma</code></td><td>&#x03B3;</td><td>Rotation about local Z</td></tr>
              </tbody>
            </table>

            <h3>Geometry Class DOF Constraints</h3>
            <p>Different geometry types constrain different degrees of freedom:</p>

            <table class="info-table">
              <thead>
                <tr><th>Geometry</th><th>Constrained</th><th>Free</th></tr>
              </thead>
              <tbody>
                <tr><td><code>plane</code></td><td>w, &#x03B1;, &#x03B2;</td><td>u, v, &#x03B3;</td></tr>
                <tr><td><code>cylinder</code></td><td>u, v, &#x03B1;, &#x03B2;</td><td>w, &#x03B3;</td></tr>
                <tr><td><code>sphere</code></td><td>u, v, w</td><td>&#x03B1;, &#x03B2;, &#x03B3;</td></tr>
                <tr><td><code>cone</code></td><td>u, v, w, &#x03B1;, &#x03B2;</td><td>&#x03B3;</td></tr>
                <tr><td><code>line</code></td><td>u, v</td><td>w, &#x03B1;, &#x03B2;, &#x03B3;</td></tr>
                <tr><td><code>point</code></td><td>u, v, w</td><td>&#x03B1;, &#x03B2;, &#x03B3;</td></tr>
              </tbody>
            </table>

            <h3>Jacobian Propagation</h3>
            <p>TDT uses Jacobian matrices to propagate deviations through the tolerance chain. For each contributor, the deviation at position <strong>P</strong> is:</p>
            <div class="output-block">
δP = δT + δR × (P - O)

where:
  δT = [u, v, w]           (translation deviation)
  δR = [α, β, γ]           (rotation deviation)
  O  = feature origin
  P  = point of interest</div>

            <h3>GD&T to Torsor Mapping</h3>
            <p>The <code>compute-bounds</code> command applies these rules:</p>
            <ol>
              <li>Parse GD&T controls from feature</li>
              <li>For each control, determine affected DOFs based on geometry class</li>
              <li>Compute bounds: translation tolerances → ±(tol/2), angular tolerances → ±(tol/length)</li>
              <li>Apply material condition bonus if actual size provided</li>
              <li>Merge multiple controls (tightest bound wins for same DOF)</li>
            </ol>
          </section>

          <section id="reference" class="tutorial-section">
            <h2>Reference</h2>

            <h3>CLI Commands</h3>
            <table class="info-table">
              <thead>
                <tr><th>Command</th><th>Description</th></tr>
              </thead>
              <tbody>
                <tr><td><code>tdt feat compute-bounds FEAT@1</code></td><td>Show computed torsor bounds from GD&T</td></tr>
                <tr><td><code>tdt feat compute-bounds FEAT@1 --update</code></td><td>Compute and save to file</td></tr>
                <tr><td><code>tdt feat compute-bounds FEAT@1 --actual-size 20.01</code></td><td>Include MMC/LMC bonus</td></tr>
                <tr><td><code>tdt tol analyze TOL@1 --3d</code></td><td>Run 3D SDT analysis</td></tr>
                <tr><td><code>tdt tol analyze TOL@1 --3d --visualize</code></td><td>With chain visualization</td></tr>
                <tr><td><code>tdt validate</code></td><td>Check for stale torsor bounds</td></tr>
                <tr><td><code>tdt validate --fix</code></td><td>Auto-fix stale bounds</td></tr>
              </tbody>
            </table>

            <h3>GD&T Field Format</h3>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">yaml</span></div>
              <pre><code>gdt:
  - symbol: position           <span class="comment"># GD&T symbol name</span>
    value: 0.25                <span class="comment"># Tolerance value</span>
    datum_refs: [A, B, C]      <span class="comment"># Datum references (optional)</span>
    material_condition: mmc    <span class="comment"># mmc, lmc, or rfs (default)</span></code></pre>
            </div>

            <h3>Supported Symbols</h3>
            <p><code>position</code>, <code>concentricity</code>, <code>symmetry</code>, <code>perpendicularity</code>, <code>parallelism</code>, <code>angularity</code>, <code>flatness</code>, <code>cylindricity</code>, <code>circularity</code>, <code>straightness</code>, <code>circular_runout</code>, <code>total_runout</code>, <code>profile_line</code>, <code>profile_surface</code></p>

            <h3>Further Reading</h3>
            <ul>
              <li><a href="https://github.com/jackhale98/TDT/blob/main/docs/feature.md" style="color: var(--accent)">Feature Entity Reference</a></li>
              <li><a href="https://github.com/jackhale98/TDT/blob/main/docs/stackup.md" style="color: var(--accent)">Stackup Entity Reference</a></li>
              <li><a href="tolerance.html" style="color: var(--accent)">Tolerance Analysis Overview</a></li>
            </ul>
          </section>

        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="logo.svg" alt="TDT" width="32" height="32">
          <span class="footer-text">TDT - Tessera Design Toolkit</span>
        </div>
        <div class="footer-links">
          <a href="https://github.com/jackhale98/TDT">GitHub</a>
          <a href="https://github.com/jackhale98/TDT/blob/main/LICENSE">MIT License</a>
          <a href="https://github.com/jackhale98/TDT/issues">Issues</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function toggleMobileMenu() {
      document.getElementById('mobileMenu').classList.toggle('open');
    }
    function closeMobileMenu() {
      document.getElementById('mobileMenu').classList.remove('open');
    }
  </script>
</body>
</html>
