{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://pdt.dev/schemas/feature.schema.json",
  "title": "Feature",
  "description": "A dimensional feature on a component with tolerances",
  "type": "object",
  "required": ["id", "component", "feature_type", "title", "status", "created", "author"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^FEAT-[0-9A-Z]{26}$",
      "description": "Unique identifier (FEAT prefix + ULID)"
    },
    "component": {
      "type": "string",
      "pattern": "^CMP-[0-9A-Z]{26}$",
      "description": "Parent component ID (REQUIRED)"
    },
    "feature_type": {
      "type": "string",
      "enum": ["internal", "external"],
      "description": "Feature type classification - internal (hole, bore, pocket) or external (shaft, boss)"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "Short descriptive title"
    },
    "description": {
      "type": "string",
      "description": "Detailed description"
    },
    "dimensions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "nominal", "plus_tol", "minus_tol"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Dimension name (e.g., diameter, length)"
          },
          "nominal": {
            "type": "number",
            "description": "Nominal value"
          },
          "plus_tol": {
            "type": "number",
            "minimum": 0,
            "description": "Plus tolerance (positive number, e.g., 0.1 means +0.1)"
          },
          "minus_tol": {
            "type": "number",
            "minimum": 0,
            "description": "Minus tolerance (positive number, e.g., 0.05 means -0.05)"
          },
          "units": {
            "type": "string",
            "default": "mm",
            "description": "Units (mm, in, etc.)"
          },
          "internal": {
            "type": "boolean",
            "default": false,
            "description": "Whether this is an internal feature (hole/slot/pocket) vs external (shaft/boss)"
          },
          "distribution": {
            "type": "string",
            "enum": ["normal", "uniform", "triangular"],
            "default": "normal",
            "description": "Statistical distribution for tolerance analysis"
          }
        }
      },
      "description": "Dimensional characteristics with tolerances"
    },
    "gdt": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["symbol", "value"],
        "properties": {
          "symbol": {
            "type": "string",
            "enum": ["position", "flatness", "perpendicularity", "parallelism", "concentricity", "runout", "total_runout", "profile_surface", "profile_line", "circularity", "cylindricity", "straightness", "angularity", "symmetry"],
            "description": "GD&T symbol"
          },
          "value": {
            "type": "number",
            "minimum": 0,
            "description": "Tolerance value"
          },
          "units": {
            "type": "string",
            "default": "mm",
            "description": "Units"
          },
          "datum_refs": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Datum references (e.g., A, B, C)"
          },
          "material_condition": {
            "type": "string",
            "enum": ["mmc", "lmc", "rfs"],
            "default": "rfs",
            "description": "Material condition modifier"
          }
        }
      },
      "description": "GD&T controls"
    },
    "geometry_class": {
      "type": "string",
      "enum": ["plane", "cylinder", "sphere", "cone", "point", "line", "complex"],
      "description": "Geometry class for 3D tolerance analysis (SDT invariance class)"
    },
    "datum_label": {
      "type": "string",
      "pattern": "^[A-Z]$",
      "description": "Datum label (A, B, C) if this feature is used as a datum"
    },
    "geometry_3d": {
      "type": "object",
      "properties": {
        "origin": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 3,
          "maxItems": 3,
          "description": "Origin point [x, y, z] in component coordinate system"
        },
        "axis": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 3,
          "maxItems": 3,
          "description": "Axis direction [dx, dy, dz] - unit vector for feature orientation"
        },
        "length": {
          "type": "number",
          "description": "Optional length for axial features (cylinders, cones)"
        }
      },
      "required": ["origin", "axis"],
      "description": "3D geometry definition for kinematic chain analysis"
    },
    "torsor_bounds": {
      "type": "object",
      "properties": {
        "u": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Translation along local X [min, max]"
        },
        "v": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Translation along local Y [min, max]"
        },
        "w": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Translation along local Z [min, max]"
        },
        "alpha": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Rotation about local X [min, max] in radians"
        },
        "beta": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Rotation about local Y [min, max] in radians"
        },
        "gamma": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Rotation about local Z [min, max] in radians"
        }
      },
      "description": "Torsor bounds computed from tolerances and geometry class"
    },
    "drawing": {
      "type": "object",
      "properties": {
        "number": {
          "type": "string",
          "description": "Drawing number"
        },
        "revision": {
          "type": "string",
          "description": "Drawing revision"
        },
        "zone": {
          "type": "string",
          "description": "Zone on drawing (e.g., B3)"
        }
      },
      "description": "Drawing reference"
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Tags for filtering and organization"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "review", "approved", "released", "obsolete"],
      "default": "draft",
      "description": "Current status"
    },
    "links": {
      "type": "object",
      "properties": {
        "used_in_mates": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Mate IDs using this feature"
        },
        "used_in_stackups": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Stackup IDs using this feature"
        },
        "allocated_from": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Requirement IDs allocated to this feature"
        },
        "risks": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Risk IDs affecting this feature"
        }
      }
    },
    "created": {
      "type": "string",
      "format": "date-time",
      "description": "Creation timestamp"
    },
    "author": {
      "type": "string",
      "description": "Author name"
    },
    "entity_revision": {
      "type": "integer",
      "minimum": 1,
      "default": 1,
      "description": "Entity revision number"
    }
  },
  "additionalProperties": false
}
